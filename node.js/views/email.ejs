<%- include('parts/html-head') %>
<%- include('parts/navbar') %>

<div class="container">
    <div class="row">
        <div class="col-md-6">
            <div class="card" >
                <div class="card-body">
                    <h5 class="card-title">登入</h5>

                    <form name="form1" onsubmit="checkForm(); return false;">
                        <div class="form-group">
                            <label class="sr-only" for="form-username">Username</label>
                             <input type="text" name="username" placeholder="請輸入賬號..."  class="form-username form-control" id="form-username">
                          </div>
                          <div class="form-group">
                             <label class="sr-only" for="form-password">Password</label>
                             <input type="password" name="password" placeholder="請輸入密碼..."  class="form-password form-control" id="form-password">
                          </div>
                          <div class="form-group">
                             <label class="sr-only" for="form-password">Email</label>
                             <input type="text" name="email" placeholder="請輸入郵箱..." class="form-password form-control" id="email"><br>
                             <input type="button"  onclick="abc()" class="btn btn-danger" id="emialcore" value="傳送驗證碼">
                             <input type="text" name="code" placeholder="請輸入驗證碼..." id="code">
                          </div>

                        <button type="submit" class="btn btn-primary">登入</button>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>
<%- include('parts/scripts') %>
<script>
    const email = document.querySelector('#email');

    function checkForm(){

        // TODO: 欄位檢查


        const fd = new FormData(document.form1);

        fetch('/email', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams(fd).toString(),
        }).then(r=>r.json()).then(obj=>{
            console.log(JSON.stringify(obj, null, 4));
            if(obj.success){
                alert('登入成功');
                location.href ='/';
            } else {
                alert('登入失敗\n' + (obj.error || ''));
            }
        });


    }



    //------


    // function abc() {
    //             const time = 60;//定義60秒的倒計時
    //             const email = $('#email').val();//獲取輸入框的郵箱
    //             const user_name = $('#form-username').val();//獲取輸入的賬戶名
                
    //             //這裡我用的是ajax將使用者名稱和郵箱發到後臺
    //             $.get('/api/email',
    //                 {
    //                     email:email,
    //                     user_name:user_name
    //                 },
    //                 function (data) {
    //                     console.log(data)
      
    //                 }
    //             )
                
    //             //設定一個定時，一秒執行一次
    //             const mytime = setInterval(function () {
    //                 subs();
    //             },1000)

                
    //             function subs(){
    //                 time--;
    //                 $('#emialcore').attr("value","請"+time+"秒後再試");
    //                 if(time===0){
    //                     clearInterval(mytime);
    //                     $('#emialcore').attr("value","傳送驗證碼");
    //                     $('#emialcore').attr("disabled",false);//按鍵可用
    //                 } else{
    //                     $('#emialcore').attr("disabled",true);//按鍵不可用
    //                 }
    //             }

               
    //         }

</script>
<%- include('parts/html-foot') %>